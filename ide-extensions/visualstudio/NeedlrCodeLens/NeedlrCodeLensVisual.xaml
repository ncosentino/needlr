<DataTemplate xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
              xmlns:colors="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.15.0"
              xmlns:vs="http://schemas.microsoft.com/visualstudio/extensibility/2022/xaml">
    <Border Padding="8,6" MinWidth="280"
            Background="{DynamicResource {x:Static colors:EnvironmentColors.ToolWindowBackgroundBrushKey}}">
        <StackPanel TextElement.Foreground="{DynamicResource {x:Static colors:EnvironmentColors.ToolWindowTextBrushKey}}">
            <!-- Header -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                <TextBlock Text="{Binding LifetimeSymbol}" FontSize="14" Margin="0,0,4,0"/>
                <TextBlock Text="{Binding TypeName}" FontWeight="Bold" FontSize="13"/>
            </StackPanel>
            
            <!-- Lifetime & Assembly Row -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,2">
                <TextBlock Text="Lifetime: " Opacity="0.6" FontSize="11"/>
                <TextBlock Text="{Binding Lifetime}" FontWeight="SemiBold" FontSize="11"/>
                <TextBlock Text="  •  Assembly: " Opacity="0.6" FontSize="11"/>
                <TextBlock Text="{Binding AssemblyName}" FontSize="11"/>
            </StackPanel>
            
            <!-- Captive Warning -->
            <Border Background="#3F6107" Padding="6,4" Margin="0,6,0,0" CornerRadius="3"
                    Visibility="{Binding HasCaptiveDependencyVisibility}">
                <TextBlock Text="⚠ Captive dependency: shorter-lived service in longer-lived parent" 
                           Foreground="#FFC107" FontSize="11"/>
            </Border>
            
            <!-- Dependencies Section -->
            <TextBlock Margin="0,8,0,4" FontSize="11">
                <Run Text="Dependencies (" FontWeight="SemiBold"/>
                <Run Text="{Binding DependencyCount}"/>
                <Run Text=", depth "/>
                <Run Text="{Binding MaxDepth}"/>
                <Run Text=")" FontWeight="SemiBold"/>
            </TextBlock>
            
            <ItemsControl ItemsSource="{Binding Dependencies}" Margin="8,0,0,0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Command="{Binding NavigateCommand}" 
                                Cursor="Hand"
                                Background="Transparent"
                                BorderThickness="0"
                                HorizontalContentAlignment="Left"
                                Padding="0,1">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="→ " Opacity="0.5" FontSize="11"/>
                                <TextBlock Text="{Binding TypeName}" 
                                           Foreground="{DynamicResource {x:Static colors:EnvironmentColors.ControlLinkTextBrushKey}}"
                                           FontSize="11"/>
                                <TextBlock Text=" [" Opacity="0.5" FontSize="11"/>
                                <TextBlock Text="{Binding Lifetime}" Opacity="0.5" FontSize="11"/>
                                <TextBlock Text="]" Opacity="0.5" FontSize="11"/>
                                <TextBlock Text=" ⚠" Foreground="#FFC107" FontSize="11"
                                           Visibility="{Binding IsCaptiveVisibility}"/>
                            </StackPanel>
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            
            <!-- Used By Section -->
            <TextBlock Margin="0,8,0,4" FontSize="11">
                <Run Text="Used By (" FontWeight="SemiBold"/>
                <Run Text="{Binding UsedByCount}"/>
                <Run Text=" services)" FontWeight="SemiBold"/>
            </TextBlock>
            
            <ItemsControl ItemsSource="{Binding UsedBy}" Margin="8,0,0,0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Command="{Binding NavigateCommand}"
                                Cursor="Hand"
                                Background="Transparent"
                                BorderThickness="0"
                                HorizontalContentAlignment="Left"
                                Padding="0,1">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="← " Opacity="0.5" FontSize="11"/>
                                <TextBlock Text="{Binding TypeName}" 
                                           Foreground="{DynamicResource {x:Static colors:EnvironmentColors.ControlLinkTextBrushKey}}"
                                           FontSize="11"/>
                                <TextBlock Text=" [" Opacity="0.5" FontSize="11"/>
                                <TextBlock Text="{Binding Lifetime}" Opacity="0.5" FontSize="11"/>
                                <TextBlock Text="]" Opacity="0.5" FontSize="11"/>
                            </StackPanel>
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            
            <!-- Interfaces Section -->
            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                <TextBlock Text="Implements: " FontWeight="SemiBold" Opacity="0.8" FontSize="11"/>
                <TextBlock Text="{Binding InterfacesDisplay}" Opacity="0.7" FontSize="11"/>
            </StackPanel>
        </StackPanel>
    </Border>
</DataTemplate>
